var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{y$:()=>n,KS:()=>v,Ax:()=>o,tz:()=>r,MI:()=>a,oj:()=>s,dy:()=>y,d4:()=>b,sO:()=>p,eJ:()=>f});class n{constructor(e){this._value=e,this._subscribers=[]}next(e){this._value=e;for(const t of this._subscribers)t(e)}subscribe(e){this._subscribers.push(e)}complete(){this._subscribers=new Proxy([],{set:()=>{throw new Error("Observable has been completed.")}})}restore(){this._subscribers=[],this._value=void 0}}class r{constructor(){this.current}}class s{constructor(e){this.observable=e,this.value=e._value,e.subscribe((e=>{this.value=e}))}valueOf(){return this.value}toString(){return this.value.toString()}}class o{constructor(e){this.ID=(Math.random()+1).toString(36).substring(2),i[this.ID]=this,this.setElement(e)}setElement(e){this.element=e,this.element.setAttribute&&this.element.setAttribute("data-is-snowblind-child",this.ID)}}const i={},c={},a=new n;class l{constructor(e,t={}){if(e._Observer.boundRender=this,this._wasDestroyed=!1,this._renderIsFirstTime=!0,this._maxCopies=e._maxCopies,this._copiesKeptAlive=0,this._lastNode=t.replace||document.body.appendChild(document.createElement("i")),this._Node,this.Object=e,!(e instanceof v.Component))throw new Error("Renderer didn't receive object of type Snowblind.Component")}Render(){if(this._wasDestroyed)throw new Error("Renderer has been destroyed.");if(this.Object._usesTransition){const e=this._Node;this._copiesKeptAlive>=this._maxCopies?e.remove():this.Object.transitionFunction.leave((()=>{e.remove(),this._copiesKeptAlive-=1}))}var e=this.Object.render();if(!(e instanceof HTMLElement))throw new Error("Can only initialize object with type of HTMLElement.");this._Node=e,this.Object.Node=this._Node;var t=this._Node;const n=document.activeElement,r=n.selectionStart,s=n.selectionEnd;let o;if((o=this._lastNode.getAttribute("data-is-snowblind-child"))&&i[o].setElement(this._Node),this._lastNode.replaceWith(this._Node),n){const e=n.getAttribute("key");if(e){const n=t.querySelector(`[key='${e}']`);n.focus(),n.setSelectionRange(r,s)}}if(this._lastNode=t,this.Object._usesTransition&&(this._copiesKeptAlive++,this.Object.transitionFunction.from((()=>{this._renderIsFirstTime||this.Object.transitionFunction.render()}))),this.Object.hasTheme){const e=document.createElement("div"),n=(e,t)=>{const n=this.Object.hasTheme[t];for(const r of Array.from(e))if("object"==typeof n)for(const e in n)r.style[e]=n[e];else r.style[t]=n};for(const r in this.Object.hasTheme){const s=t.querySelectorAll(r);s&&s.length>0?n(s,r):void 0!==e.style[r]&&n(Array.from(t.getElementsByTagName("*")).concat([t]),r)}}!0===this._renderIsFirstTime?(d(this.Object.didMountCallbacks,this._Node),this._renderIsFirstTime=!1):d(this.Object.didUpdateCallbacks,this._Node)}reinitialize(){this._renderIsFirstTime=!0,this.constructor(this.Object)}Destroy(){this._wasDestroyed=!0,d(this.Object.willUnmountCallbacks),this.Object._usesTransition?this.Object.transitionFunction.leave((()=>{this._Node.remove()})):this._Node.remove()}}const d=(e,...t)=>e.map((e=>e(...t))),u=Symbol("");class h{constructor(e,t=(()=>{})){const n={get(e,t){if(t===u)return!0;const r=e[t];if(void 0!==r){if(null!==r){var s=r.constructor;r[u]||!s||s!=={}.constructor&&s!==[].constructor||(e[t]=new Proxy(r,n))}return e[t]}},set:(e,n,r)=>(e[n]=r,this.boundRender&&(this.debounce&&window.cancelAnimationFrame(this.debounce),this.debounce=window.requestAnimationFrame((()=>{this.boundRender.Render()}))),t(e,n,r),!0)};this._value=new Proxy(e,n)}}function f(e,t=!0){const r=new n(e);var o=new s(r);return!0===t&&a.subscribe((e=>{const t=e.Renderer;r.subscribe((()=>{t.Render()}))})),[o,e=>("function"==typeof e&&(e=e()),e=e.valueOf(),r.next(e),e)]}const m=function e(t,n){if(t===n)return!0;if(!(t instanceof Object&&n instanceof Object))return!1;if(t.constructor!==n.constructor)return!1;for(var r in t)if(t.hasOwnProperty(r)){if(!n.hasOwnProperty(r))return!1;if(t[r]!==n[r]){if("object"!=typeof t[r])return!1;if(!e(t[r],n[r]))return!1}}for(r in n)if(n.hasOwnProperty(r)&&!t.hasOwnProperty(r))return!1;return!0};function b(e,t=[]){var n=t.map((e=>e.valueOf()));a.subscribe((r=>{const s=r=>{n.length>0?(n.filter(((e,n)=>!m(e,t[n].valueOf()))).length>0||0==n.length)&&(e(r),n=t.map((e=>e.valueOf()))):e(r)};r.onComponentDidMount(s),r.onComponentDidUpdate(s)}))}function p(){return new class{constructor(){this.current}}}window.expose=function(e,t){t=Array.from([t]).flat();for(const r in e){const s=e[r];var n=(void 0===t[0]?r:t[0]).toLowerCase();c[n]=s}};const v={Component:class{constructor(e,t,n={hasTheme:!1,replace:void 0}){const r=c[t.name.toLowerCase()];if(r){const t=r.propTypes;t&&window.typeCheck&&(e=window.typeCheck(e,t,r.defaultProps))}this.hasTheme=n.hasTheme,this._maxCopies=1/0,this._usesTransition=!1,this.didMountCallbacks=[],this.didUpdateCallbacks=[],this.willUnmountCallbacks=[],n.replace instanceof HTMLElement&&(e.children=Array.from(n.replace.childNodes).map((e=>new o(e)))),this._Observer=new h(e||{}),this.props=this._Observer._value,this.Renderer=new l(this,n);const s=n.replace.isReferenceTo;this._generatorFunction=t(e,s),a.next(this),a.restore(),this.Renderer.Render()}onComponentDidMount(e){this.didMountCallbacks.push(e)}onComponentDidUpdate(e){this.didUpdateCallbacks.push(e)}onComponentWillUnmount(e){this.willUnmountCallbacks.push(e)}render(...e){return this._generatorFunction()}},createContext(e){if("object"!=typeof e)throw new TypeError("`createContext` may only be used with objects.");const t=new n(e);return[new h(e,(e=>{t.next(e)}))._value,t]},renderAllIn(e=document.body){const t=e=>{for(const n of e){if(n instanceof HTMLScriptElement)continue;let e=n.nodeName.toLowerCase();if(c.hasOwnProperty(e)){let t=c[e];if("function"==typeof t){const e=this.getNodeProperties(n);new v.Component(e,t,{hasTheme:!1,replace:n})}}else t(Array.from(n.children))}};t(Array.from(e.children))},getNodeProperties:e=>Object.fromEntries(Array.from(e.attributes).map((e=>[e.name,e.value]))),eventBus:{on(e,t){document.addEventListener(e,(e=>t(e instanceof CustomEvent?e.detail:void 0)))},dispatch(e,t){document.dispatchEvent(new CustomEvent(e,{detail:t}))},remove(e,t){document.removeEventListener(e,t)}},createElement:(e,t,n=[])=>{let r=document.createElement(e);for(let e in t)if(Object.hasOwnProperty.call(t,e)){let n=t[e];if(null!=n)if("text"==e)r.innerText=n;else{let t=e.substring(1).replace("@","");if("@"===e[0])r.addEventListener(e,(t=>{"@"==e[1]&&t.target.isEqualNode(r),n(r,t)}));else if("."===e[0])r[t]=n;else if("?"===e[0])n&&r.setAttribute(t,n);else if("object"==typeof n)for(const e in n)r.setAttribute(e,n[e]);else r.setAttribute(e,n)}}for(let e of n)"function"==typeof e||e instanceof HTMLElement&&r.appendChild(e);return r}};function y(e,...t){function n(e,t,n,r){e.addEventListener(t,(t=>{r&&t.target.isEqualNode(e)?n(e,t):r||n(e,t)}))}function r(e,t){var n=document.createTextNode(t);e.appendChild(n)}const i=/\{\{([0-9]+)\}\}/g;var c="",a=0;for(const t of e)c+=t+(e[e.length-1]===t?"":`{{${a++}}}`);const l=document.createElement("template");if(l.innerHTML=c,l.content.children.length>1)throw new Error("Multiple elements must be wrapped in a single element.");const d=document.createTreeWalker(l.content,1,null);let u,h=0;for(;null!==(u=d.nextNode());){(u instanceof HTMLTextAreaElement||u instanceof HTMLInputElement)&&(u.hasAttribute("key")||(u.setAttribute("key","inputNo"+h),h++));for(const e of Array.from(u.attributes)){var f=e.name;let r=e.nodeValue;var m=f[0],b=f.substring(1);const o=/\{([@.?!]+)\}/;r=r.replace(i,((e,r)=>{var i,c=parseInt(r),a=t[c],l="";if("ref"===f&&"SnowblindRef"===(null===(i=null==a?void 0:a.constructor)||void 0===i?void 0:i.name))return a.current=u,u.isReferenceTo=a,void u.removeAttribute("ref");if("sx"===f){if("string"==typeof a)u.setAttribute("style",a);else if("object"==typeof a)for(const e in a)u.style[e]=a[e];return void u.removeAttribute("sx")}const d=f.match(o);var h=[];const p=e=>{let t=0;for(const n of h)!1!==e(n[0],n[1])?t++:(delete h[t],h=h.filter((e=>e)))},v=(e,t=!0)=>{"!"===e?((e=!1)=>{for(const t in a)e?h.push([t,a[t]]):u.setAttribute(t,a[t])})(t):"."===e?((e=!1)=>{e?p(((e,t)=>{u[e]=t})):u[b]=a})(t):"?"===e?((e=!1)=>{e?p(((e,t)=>{if(t instanceof s&&(t=t.valueOf()),!t)return!1})):(a instanceof s&&(a=a.valueOf()),a&&(u[b]=a))})(t):"@"===e?((e=!1)=>{if(e)p(((e,t)=>(n(u,e,t,!1),!1)));else{var t=!1;"@"===f[1]&&(t=!0,b=b.substring(1)),n(u,b,a,t)}})(t):l=a};if(d)for(const e of d[1])v(e,!0);else v(m,!1);return p(((e,t)=>{u.setAttribute(e,t)})),l})),-1!==["@",".","?","!"].indexOf(m)||f.match(o)?u.removeAttribute(f):"ref"!==f&&"sx"!==f&&u.setAttribute(f,r)}var p=Array.from(u.childNodes);for(const e of p)if(e.nodeType===Node.TEXT_NODE){var y=e.textContent;const n=Array.from(y.matchAll(i));y=y.replace(i,(e=>" ".repeat(e.length))),n.length>0&&(e.textContent="");var _=0;for(let i=0;i<n.length;i++){const c=n[i];var O=parseInt(c[1]),A=t[O],E=y.substring(_,c.index);""!==E&&r(u,E);const a=t=>{t instanceof o?a(t.element):t instanceof HTMLElement||t instanceof SVGElement||t instanceof Text?w(t,e):Array.isArray(t)?t.slice().reverse().map((e=>a(e))):t!==Object(t)||t instanceof s?r(u,t):console.error("Only instances of HTMLElement, SVGElement, Text, Array or SnowblindChild are supported.")};if(a(A),i==n.length-1){e.remove();var T=y.substring(c.index+c[0].length);""!=T&&r(u,T)}_=c.index+A&&A.length}}}const g=l.content.children[0];return v.renderAllIn(g),g}window.addEventListener("load",(()=>{v.renderAllIn()})),HTMLElement.prototype.insertAfter=function(e){e&&e.parentNode&&e.parentNode.insertBefore(this,e.nextSibling)};const w=function(e,t){t&&t.parentNode&&t.parentNode.insertBefore(e,t.nextSibling)};var _=t.y$,O=t.KS,A=t.Ax,E=t.tz,T=t.MI,g=t.oj,C=t.dy,x=t.d4,j=t.sO,N=t.eJ;export{_ as Observable,O as Snowblind,A as SnowblindChild,E as SnowblindRef,T as UpdateDispatcher,g as ValueBinder,C as html,x as useEffect,j as useRef,N as useState};